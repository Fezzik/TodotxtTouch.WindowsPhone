<phone:PhoneApplicationPage x:Class="TodotxtTouch.WindowsPhone.MainPivot" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone" xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone" xmlns:controls="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:WindowsPhone="clr-namespace:TodotxtTouch.WindowsPhone" xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" xmlns:cmd="clr-namespace:GalaSoft.MvvmLight.Command;assembly=GalaSoft.MvvmLight.Extras.WP7" xmlns:li="clr-namespace:TodotxtTouch.WindowsPhone.Interactivity" xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit" xmlns:ValueConverters="clr-namespace:TodotxtTouch.WindowsPhone.ValueConverters" mc:Ignorable="d" d:DesignWidth="480" d:DesignHeight="696" FontFamily="{StaticResource PhoneFontFamilyNormal}" FontSize="{StaticResource PhoneFontSizeNormal}" Foreground="{StaticResource PhoneForegroundBrush}" SupportedOrientations="Portrait" Orientation="Portrait" shell:SystemTray.IsVisible="True" DataContext="{Binding Main, Source={StaticResource Locator}}">

    <phone:PhoneApplicationPage.Resources>
        <ValueConverters:BooleanOpacityConverter x:Key="BooleanOpacityConverter"></ValueConverters:BooleanOpacityConverter>
    </phone:PhoneApplicationPage.Resources>
    
	<!--LayoutRoot is the root grid where all page content is placed-->
	<Grid x:Name="LayoutRoot" Background="Transparent">

		<WindowsPhone:DropBoxLogin x:Name="DropBoxLogin" Visibility="Collapsed" Opacity="0"></WindowsPhone:DropBoxLogin>

        <toolkit:PerformanceProgressBar x:Name="performanceProgressBar" IsIndeterminate="{Binding Busy}" />

        <!--Pivot Control-->
		<controls:Pivot Title="{Binding ApplicationTitle}" x:Name="TaskPivot" 
                        Opacity="{Binding Busy, Converter={StaticResource BooleanOpacityConverter}, ConverterParameter=0.2}">
			<!--Pivot item all-->
			<controls:PivotItem Header="all" x:Name="AllTasksPivotItem">
				<WindowsPhone:TaskListBox x:Name="AllTasksList" ItemsSource="{Binding AllTasks}"></WindowsPhone:TaskListBox>
			</controls:PivotItem>

			<!--Pivot item contexts-->
			<controls:PivotItem Header="contexts">
				<ListBox ItemsSource="{Binding Contexts}"
                         SelectionMode="Single"
                         SelectedItem="{Binding SelectedContext, Mode=TwoWay}">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Grid Margin="5,5">
								<StackPanel Orientation="Horizontal">
									<TextBlock Text="{Binding}" />
								</StackPanel>
							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>
                    <toolkit:GestureService.GestureListener>
                        <toolkit:GestureListener />
                    </toolkit:GestureService.GestureListener>

                    <i:Interaction.Behaviors>
                        <li:GestureBehavior />
                    </i:Interaction.Behaviors>

                    <i:Interaction.Triggers>
                        <li:TapTrigger>
                            <cmd:EventToCommand Command="{Binding FilterByContextCommand}" />
                        </li:TapTrigger>
                    </i:Interaction.Triggers>
                </ListBox>
			</controls:PivotItem>

			<!--Pivot item projects-->
			<controls:PivotItem Header="projects">
				<ListBox ItemsSource="{Binding Projects}" 
                         SelectionMode="Single"
                         SelectedItem="{Binding SelectedProject, Mode=TwoWay}">
					<ListBox.ItemTemplate>
						<DataTemplate>
							<Grid Margin="5,5">
								<StackPanel Orientation="Horizontal">
									<TextBlock Text="{Binding}" />
								</StackPanel>

							</Grid>
						</DataTemplate>
					</ListBox.ItemTemplate>

                    <toolkit:GestureService.GestureListener>
                        <toolkit:GestureListener />
                    </toolkit:GestureService.GestureListener>

                    <i:Interaction.Behaviors>
                        <li:GestureBehavior />
                    </i:Interaction.Behaviors>

                    <i:Interaction.Triggers>
                        <li:TapTrigger>
                            <cmd:EventToCommand Command="{Binding FilterByProjectCommand}" />
                        </li:TapTrigger>
                    </i:Interaction.Triggers>

				</ListBox>
			</controls:PivotItem>

			<!--Pivot item completed-->
			<controls:PivotItem Header="complete">
				<WindowsPhone:TaskListBox ItemsSource="{Binding CompletedTasks}"></WindowsPhone:TaskListBox>
			</controls:PivotItem>

		</controls:Pivot>
	</Grid>

	<phone:PhoneApplicationPage.ApplicationBar>
		<shell:ApplicationBar IsVisible="True" IsMenuEnabled="True">
			<shell:ApplicationBarIconButton IconUri="/Images/add.png" x:Name="fAddButton" Text="add" />
            <shell:ApplicationBarIconButton IconUri="/Images/appbar.manage.rest.png"
                                            x:Name="MultiSelect"
                                            Text="select" />
            <shell:ApplicationBar.MenuItems>
                <shell:ApplicationBarMenuItem Click="SettingsClick"
                                              Text="Settings" />
                <shell:ApplicationBarMenuItem Click="ArchiveClick" Text="Archive"/>
                <shell:ApplicationBarMenuItem Click="LogClick"
                                              Text="View Log" />
            </shell:ApplicationBar.MenuItems>
		</shell:ApplicationBar>
	</phone:PhoneApplicationPage.ApplicationBar>

</phone:PhoneApplicationPage>